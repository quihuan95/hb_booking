$("#openRequestModal").click(function(e){var voucherCode=document.querySelector("input[name='voucherCode']:checked");var voucherPrice=document.querySelector("input[name='voucherPrice']:checked");var quantityInput=$("#quantity");var errorText1=document.getElementById('errorText1');if(!voucherCode){errorText1.innerHTML='Quý khách vui lòng chọn mẫu Voucher'}
else if(!voucherPrice){errorText1.innerHTML='Quý khách vui lòng chọn giá trị Voucher'}
else if(!quantityInput.val()||quantityInput.val()<1){errorText1.innerHTML='Quý khách vui lòng chọn số lượng';_showerror("",quantityInput)}
else{errorText1.innerHTML='';$('#voucherModal').modal('show');var total=parseFloat(voucherPrice.value)*parseInt(quantityInput.val());doInitiateCheckoutPixel('yeu-cau-voucher','Yêu cầu voucher',total,'Yêu cầu voucher','Gửi yêu cầu voucher - Mở Popup')}});$("#submitBtn").click(function(e){var voucherCode=document.querySelector("input[name='voucherCode']:checked");var voucherPrice=document.querySelector("input[name='voucherPrice']:checked");var quantityInput=$("#quantity");var nameInput=$("#fullname");var phoneInput=$("#phone");var emailInput=$("#email");var requestInput=$("#special-request");var errorText2=document.getElementById('errorText2');if(!voucherCode){errorText2.innerHTML='Quý khách vui lòng chọn mẫu Voucher'}
else if(!voucherPrice){errorText2.innerHTML='Quý khách vui lòng chọn giá trị Voucher'}
else if(!quantityInput.val()){errorText2.innerHTML='Quý khách vui lòng chọn số lượng';_showerror("",quantityInput)}
else if(!nameInput.val()){_showerror("Quý khách vui lòng điền Họ tên",nameInput)}
else if(!phoneInput.val())
_showerror("Quý khách vui lòng điền số điện thoại",phoneInput);else if(emailInput.val()!==""&&!validateEmail(emailInput.val())){emailInput.val("");_showerror("Quý khách vui lòng điền đúng định dạng email",emailInput)}
else{var phone=Static.removeFoneSpec(phoneInput.val()).replace('(+84)','0').replace('+84','0').replace('(84)','0');if(!phone.startsWith("0")||phone.length<10||phone.length>11){phoneInput.val("");_showerror("Vui lòng điền đúng định dạng số điện thoại",phoneInput);return}
errorText2.innerHTML='';var referLink=document.referrer;var otherContent=requestInput.val();if(referLink&&(referLink.indexOf('ivivu.com')!==-1||referLink.indexOf('http://localhost:4316')!==-1)){if(otherContent){otherContent+='. Tham khảo từ: '+referLink.split('?')[0]}
else{otherContent='Tham khảo từ: '+referLink.split('?')[0]}}
var dataObject=JSON.stringify({VoucherValue:voucherPrice.value,VoucherCode:voucherCode.value,Quantity:quantityInput.val(),CustomerName:nameInput.val(),Email:emailInput.val(),Phone:phone,RequestOther:otherContent,employeeKey:$("#hdhdhdhhdhdhdhdhdhd").val(),});$.ajax({url:Static.rootpay()+"gui-yeu-cau-voucher",type:"POST",dataType:"JSON",data:dataObject,contentTyp:"application/json; charset=utf-8",async:!1,crossDomain:!0,success:function(data){if(data.success){$('#voucherModal').modal('hide');quantityInput.val("");nameInput.val("");phoneInput.val("");emailInput.val("");requestInput.val("");selectBtns.find('input').prop("checked",!1);selectBtns.removeClass('active');listCodeMobile.removeClass('active');quantityInput.val(1);var total=parseFloat(voucherPrice.value)*parseInt(quantityInput.val());doPurchasePixel(total,'yeu-cau-voucher','Yêu cầu voucher','Yêu cầu voucher','Gửi yêu cầu voucher - Thành công');swal({title:"Gửi yêu cầu thành công !",text:"Nhân viên iVIVU sẽ liên hệ với Quý khách trong thời gian sớm nhất",timer:8000,type:"success"})}
else{swal({title:"Gửi yêu cầu không thành công !",text:"Vui lòng thử lại hoặc liên hệ hotline 1900 1870",timer:8000,type:"error"});handleLogging("[Ajax] gửi yêu cầu voucher","Stack: "+data.msg+', Param: '+dataObject)}},error:function(err){swal({title:"Gửi yêu cầu không thành công !",text:"Vui lòng thử lại hoặc liên hệ hotline 1900 1870",timer:8000,type:"error"});handleLogging("[Ajax] gửi yêu cầu voucher","Stack: "+JSON.stringify(err)+', Param: '+dataObject)}})}});function checkValue(el){console.log(window.location);if($(el).val()){$(el).addClass("active")}
else{$(el).removeClass("active")}}
function validateEmail(email){var regex=/\S+@\S+\.\S+/;return regex.test(email)}
function _showerror(_alert,_input){if(_input!==undefined){_input.attr("placeholder",_alert);_input.css({"border":"1px solid red"});setTimeout(function(){_input.css({"border":""})},3000)}}
var imageEl=document.getElementById('mainImage');var listImageEl=$(".list-img img");var selectBtns=$('.selection .radio-button');selectBtns.click(function(){$(this).closest('ul').find('.radio-button').removeClass('active');this.classList.add('active')});$(".code-list .radio-button").on('click',function(){var code=this.querySelector("input[name='voucherCode']").value;setImageByCode(code)});function setImageByCode(code){var imageCodeEl=listImageEl.filter("[name='"+code+"']")[0];if(imageCodeEl){imageEl.src=imageCodeEl.src;listImageEl.removeClass('active');imageCodeEl.classList.add('active')}}
listImageEl.on('click',function(){imageEl.src=this.src;listImageEl.removeClass('active');this.classList.add('active');var code=this.name;var codeInput=$("input[value='"+code+"']");if(codeInput){codeInput.prop("checked",!0);var btnCodeEl=codeInput.closest('.radio-button');btnCodeEl.closest('ul').find('.radio-button').removeClass('active');btnCodeEl.addClass('active')}});function checkButtonSlider(){if(listImageEl&&listImageEl.length>5){$('.list-img .btn-slider.right').show()}}
checkButtonSlider();$('.btn-slider').click(function(){var slider=this.parentElement;var direction=$(this).hasClass("left")?'left':$(this).hasClass("right")?'right':'';if(slider){var liWidth=slider.querySelector('li').clientWidth;var newScrollLeft=0;if(direction==='left')
newScrollLeft=slider.scrollLeft-liWidth*4;else if(direction==='right')
newScrollLeft=slider.scrollLeft+liWidth*4;slider.scrollLeft=newScrollLeft;var position=slider.clientWidth+newScrollLeft;var scrollW=slider.scrollWidth;if(position>=scrollW)
$(slider).find('.btn-slider.right').hide();else $(slider).find('.btn-slider.right').show();if(newScrollLeft<=0)
$(slider).find('.btn-slider.left').hide();else $(slider).find('.btn-slider.left').show()}});var screenWidth=(window.innerWidth>0)?window.innerWidth:screen.width;if(screenWidth<=768){var container=document.querySelector(".main-img img");container.addEventListener("touchstart",startTouch,!1);container.addEventListener("touchmove",moveTouch,!1)}
var listCodeMobile=$(".main-img li");listCodeMobile.click(function(){updateCodeMobile($(this))});function updateCodeMobile(codeBtn){listCodeMobile.removeClass('active');codeBtn.addClass('active');var code=codeBtn.text();setImageByCode(code);var codeInput=$("input[value='"+code+"']");if(codeInput)
codeInput.prop("checked",!0)}
var initialX=null;var initialY=null;function startTouch(e){initialX=e.touches[0].clientX;initialY=e.touches[0].clientY};function moveTouch(e){if(initialX===null){return}
if(initialY===null){return}
var currentX=e.touches[0].clientX;var currentY=e.touches[0].clientY;var diffX=initialX-currentX;var diffY=initialY-currentY;if(Math.abs(diffX)>Math.abs(diffY)){if(diffX>0){swipeImageMobile(!0)}else{swipeImageMobile(!1)}
e.preventDefault()}else{if(diffY>0){}else{}}
initialX=null;initialY=null}
function swipeImageMobile(isNext){var activeCodeBtn=$(".main-img li.active");var newCodeBtn;if(isNext){newCodeBtn=activeCodeBtn.next();if(newCodeBtn.length===0)
newCodeBtn=listCodeMobile[0]}
else{newCodeBtn=activeCodeBtn.prev();if(newCodeBtn.length===0)
newCodeBtn=listCodeMobile[listCodeMobile.length-1]}
updateCodeMobile($(newCodeBtn))}
function quantityBtn(btn,isUp){var input=btn.parentNode.querySelector('input[type=number]');if(isUp){if(!input.value||input.value==="0")
btn.parentNode.querySelector('button.minus').classList.add('active');input.stepUp()}
else{input.stepDown();if(!input.value||input.value==="0")
btn.classList.remove('active')}}
function getCookie(cname){var name=cname+"=";var decodedCookie=decodeURIComponent(document.cookie);var ca=decodedCookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)===' '){c=c.substring(1)}
if(c.indexOf(name)===0){return c.substring(name.length,c.length)}}
return""}
fillInfoUser();var apiUrl=Static.rootGate();function fillInfoUser(){try{var token=getCookie('auth_token');if(token){$.ajax({type:'GET',url:apiUrl+'api/Dashboard/Getuserinfo',contentType:"application/json; charset=utf-8",beforeSend:function(xhr){xhr.setRequestHeader('Authorization','Bearer '+token)},success:function(data){if(data){document.getElementById('email').value=data.email;document.getElementById('fullname').value=data.fullname;document.getElementById('phone').value=data.phone}},error:function(data){},})}}
catch(err){return}}
